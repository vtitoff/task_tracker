<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{task.key}}</title>
</head>
<body>
<a href="{% url 'queue' task.queue.key %}">{{task.queue.key}}</a>
<h2>{{task.key}} {{task.subject}}</h2>
<div class="status-section">
    <form method="post">
        {% csrf_token %}

        <h4>Текущий статус:</h4>
        <form action="" method="post">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="status">
            {{ status_form.status }}
        </form>

        <h4>Исполнитель:</h4>
        <form action="" method="post">
            {% csrf_token %}
            <input type="hidden" name="form_type" value="assignee">
            <p>{{ assignee_form.assignee }}</p>
        </form>

        <h4>Автор:</h4>
        <p>{{task.author}}</p>

        <h4>Наблюдатели:</h4>
        <p>{{task.watchers}}</p>

        <h4>Теги:</h4>
        {% for tag in task.tags.all %}
        <p>{{tag.name}}</p>
        {% endfor %}
    </form>
    <form action="" method="post">{% csrf_token %}<p>{{tags_form.tag}}</p>
        <input type="hidden" name="form_type" value="tags">
        <button type="submit">Добавить/убрать тег</button>
    </form>
    <h4>Описание:</h4>
    <form action="" method="post">
        {% csrf_token %}
        <input type="hidden" name="form_type" value="description">
        <p>{{description_form.description}}</p>
        <button type="submit">Сохранить</button>
    </form>
    {% if messages %}
    <div class="status-messages">
        {% for message in messages %}
        <div class="alert {% if message.tags %}{{ message.tags }}{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
<div class="comment-section">
    <h4>Комментарии:</h4>
    <form action="" method="post">{% csrf_token %}
        <input type="hidden" name="form_type" value="comment">
        {{comments_form.comment}}
        <p>
            <button type="submit">Отправить</button>
        </p>
    </form>
    {% for comment in task.comments.all %}
    <p>{{comment.owner}} {{comment.created}}</p>
    <p>{{comment.comment}}</p>
    <p></p>
    {% endfor %}
</div>
</body>
</html>